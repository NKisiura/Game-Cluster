<div #sidebarElement
     class="mr-4 py-4 overflow-y-auto sticky top-0 w-52 sidebar-scrollbar"
     [ngStyle]="{height: defineSidebarHeight()}"
>
  <a [routerLink]="gamesRouterLink" class="font-bold capitalize text-2xl text-white block mb-3 hover:text-grey-400 transition-colors duration-200 underline underline-offset-4 decoration-0 decoration-grey-300">All Games</a>
  <ng-container [ngTemplateOutlet]="gameCollectionsTemplate"></ng-container>
  <ng-container [ngTemplateOutlet]="browseListTemplate"></ng-container>
  <ng-container *ngFor="let entity of sidebarEntities">
    <ng-container *ngIf="getEntityViewModelByEntityType(entity) | async as viewModel"
                  [ngTemplateOutlet]="entityListTemplate"
                  [ngTemplateOutletContext]="{entityType: entity, entityList: viewModel.list, loading: viewModel.isLoading, error: viewModel.error}">
    </ng-container>
  </ng-container>
</div>

<ng-template #entityListTemplate let-entityType="entityType" let-entityList="entityList" let-loading="loading" let-error="error">
  <app-sidebar-list-title [entity-list-title]="entityType"></app-sidebar-list-title>
  <app-sidebar-list-wrapper *ngIf="entityList">
    <app-sidebar-entity-list [entity-list]="filterEntityListAccordingToMainEntitiesByEntityType(entityList, entityType)"
                             [entity-type]="entityType">
    </app-sidebar-entity-list>
  </app-sidebar-list-wrapper>
  <app-sidebar-entity-list-loading *ngIf="loading" [entity-type]="entityType"></app-sidebar-entity-list-loading>
  <app-sidebar-entity-list-error *ngIf="error" [entity-type]="entityType"></app-sidebar-entity-list-error>
</ng-template>

<ng-template #browseListTemplate>
  <a [routerLink]="browseRouterLink" class="font-bold capitalize text-2xl text-white block mb-3 hover:text-grey-400 transition-colors duration-200 underline underline-offset-4 decoration-0 decoration-grey-300">Browse</a>
  <app-sidebar-list-wrapper>
    <app-sidebar-browse-list></app-sidebar-browse-list>
  </app-sidebar-list-wrapper>
</ng-template>

<ng-template #gameCollectionsTemplate>
  <app-sidebar-list-title [entity-list-title]="'Collections'"></app-sidebar-list-title>
  <app-game-collection-list></app-game-collection-list>
</ng-template>
